<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>

    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/pygments.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="row"><h1 id="selenium-problem-with-loading-x-_ignore-_nofocus-so">selenium - problem with loading x_ignore_nofocus.so</h1>
<h2 id="problem">Problem</h2>
<p>Selenium fails to start Firefox with following error:</p>
<pre><code><div class="highlight"><pre><span class="s1">&#39;The browser appears to have exited before we could connect.</span>
<span class="s1">The output was: Failed to dlopen /usr/lib/libX11.so.6\ndlerror</span>
<span class="s1">says: /usr/lib/libX11.so.6: wrong ELF class: ELFCLASS32\n&#39;</span>
</pre></div>

</code></pre><p>In my case it was reproduced on the 64 bit machine with <a href="http://aws.amazon.com/amazon-linux-ami/">Amazon Linux AMI</a>.
The problem itself is known and there is <a href="http://code.google.com/p/selenium/issues/detail?id=2852">an issue in selenium tracker</a>.</p>
<p><!-- more -->
It is because <code>x_ignore_nofocus</code> library tries to load 32bit version of the <code>libX11</code> instead of 64bit.
In my system there are following versions of <code>libX11</code>:</p>
<pre><code><div class="highlight"><pre><span class="err">#</span> <span class="nx">find</span> <span class="o">/</span> <span class="o">|</span> <span class="nx">grep</span> <span class="nx">libX11</span><span class="p">.</span><span class="nx">so</span><span class="p">.</span><span class="mi">6</span>
<span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libX11</span><span class="p">.</span><span class="nx">so</span><span class="p">.</span><span class="mi">6</span>       <span class="o">&lt;--</span> <span class="nx">symbolic</span> <span class="nx">link</span> <span class="nx">to</span> <span class="err">`</span><span class="nx">libX11</span><span class="p">.</span><span class="nx">so</span><span class="p">.</span><span class="mf">6.3</span><span class="p">.</span><span class="mi">0</span><span class="s1">&#39;</span>
<span class="s1">/usr/lib64/libX11.so.6.3.0 &lt;-- ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, stripped</span>
<span class="s1">/usr/lib/libX11.so.6          &lt;-- symbolic link to `libX11.so.6.3.0&#39;</span>
<span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">libX11</span><span class="p">.</span><span class="nx">so</span><span class="p">.</span><span class="mf">6.3</span><span class="p">.</span><span class="mi">0</span>    <span class="o">&lt;--</span> <span class="nx">ELF</span> <span class="mi">32</span><span class="o">-</span><span class="nx">bit</span> <span class="nx">LSB</span> <span class="nx">shared</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">Intel</span> <span class="mi">80386</span><span class="p">,</span> <span class="nx">version</span> <span class="mi">1</span> <span class="p">(</span><span class="nx">SYSV</span><span class="p">),</span> <span class="nx">dynamically</span> <span class="nx">linked</span><span class="p">,</span> <span class="nx">stripped</span>
</pre></div>

</code></pre><p>At the right side (after &quot;&lt;--&quot;) is an output of <code>file /usr/libX/libX11.so.6xxx</code>.</p>
<h2 id="solution">Solution</h2>
<p>Change symbolic link <code>/usr/lib/libX11.so.6</code> to point to the 64-bit version <code>/usr/lib64/libX11.so.6.3.0</code>:</p>
<pre><code><div class="highlight"><pre><span class="err">#</span> <span class="nx">mv</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">libX11</span><span class="p">.</span><span class="nx">so</span><span class="p">.</span><span class="mi">6</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">libX11</span><span class="p">.</span><span class="nx">so</span><span class="p">.</span><span class="mi">6</span><span class="p">.</span><span class="nx">bak</span>
<span class="err">#</span> <span class="nx">ln</span> <span class="o">-</span><span class="nx">s</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libX11</span><span class="p">.</span><span class="nx">so</span><span class="p">.</span><span class="mf">6.3</span><span class="p">.</span><span class="mi">0</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">libX11</span><span class="p">.</span><span class="nx">so</span><span class="p">.</span><span class="mi">6</span>
</pre></div>

</code></pre><p>After that selenium started to work.</p>
<h2 id="links">Links</h2>
<p><a href="http://code.google.com/p/selenium/issues/detail?id=2852">bug reprot</a>.</p>
</div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/js/bootstrap.min.js"></script>
  </body>
</html>

